# Precompress files to gzip and brotli and serve them automatically

This may increase performance of your nuxt application:

Compress files to gzip and brotli at build-time,
And serve them if browser supports them.

### Please note:  
This module uses [compression-webpack-plugin](https://github.com/webpack-contrib/compression-webpack-plugin) for gzip and brotli.
compression-webpack-plugin support brotli based on [native nodejs support](https://nodejs.org/api/zlib.html#zlib_zlib_createbrotlicompress_options) added in 11.7.0, 
so if you use lower nodejs version, this module will make only gzip version for you, 
but will serve brotli as well if they exist.  

Module does not override render.compressor option, so it compress only build static files /.nuxt/dist/client/.


## Installation

```bash
$ yarn add nuxt-precompress # or npm install
```

## Usage

As usual, add to modules section, not buildModules because of middleware using
set options, if needed, this are defaults:

```javascript
// nuxt.config.js
import zlib from 'zlib'

export default {
  // ...
  modules: ['nuxt-precompress'],
  // Default options, override if needed
  nuxtPrecompress: {
    enabled: true, // Enable in production
    report: false, // set true to turn one console messages during module init
    test: /\.(js|css|html|txt|xml|svg)$/, // files to compress on build
    // Serving options
    middleware: {
      // You can disable middleware if you serve static files using nginx...
      enabled: true,
      // Enable if you have .gz or .br files in /static/ folder
      enabledStatic: true, 
      // Priority of content-encodings, first matched with request Accept-Encoding will me served
      encodingsPriority: ['br', 'gzip'],
    },
 
    // build time compression settings
    gzip: {
      // should compress to gzip?
      enabled: true,
      // compression config
      // https://www.npmjs.com/package/compression-webpack-plugin
      filename: '[path][base].gz[query]', // middleware will look for this filename
      threshold: 10240,
      minRatio: 0.8,
      compressionOptions: {
        params: {
          level: 9
        }
      },
    },
    brotli: {
      // should compress to brotli?
      enabled: true,
      // compression config
      // https://www.npmjs.com/package/compression-webpack-plugin
      filename: '[path][base].br[query]', // middleware will look for this filename
      compressionOptions: {
        params: {
          [zlib.constants.BROTLI_PARAM_QUALITY]: 11
        }
      },
      threshold: 10240,
      minRatio: 0.8,
    },
  }
  // ...
}
```


## Development

```bash
$ git clone https://github.com/frenchrabbit/nuxt-precompress.git
$ cd nuxt-precompress
$ yarn
```

## License

## Note

This project generated by [create-nuxt-module](https://github.com/potato4d/create-nuxt-module)
